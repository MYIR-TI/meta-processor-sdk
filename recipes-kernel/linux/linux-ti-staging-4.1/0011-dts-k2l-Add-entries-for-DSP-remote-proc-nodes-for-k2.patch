From 4e85d498c3d1b467656f7ce178221ba7a3eb5658 Mon Sep 17 00:00:00 2001
From: Sam Nelson <sam.nelson@ti.com>
Date: Tue, 20 Oct 2015 07:20:38 -0400
Subject: [PATCH 11/12] dts: k2l: Add entries for DSP remote proc nodes for k2l
 platform

- Add entries for common memory pool to be used for Remote proc
- Add reserved area for dsp code and data usage
- Add entries for DSP remot proc nodes & common memory node

Signed-off-by: Sam Nelson <sam.nelson@ti.com>
---
 arch/arm/boot/dts/k2l-evm.dts | 46 ++++++++++++++++++++++++
 arch/arm/boot/dts/k2l.dtsi    | 84 +++++++++++++++++++++++++++++++++++++++++++
 2 files changed, 130 insertions(+)

diff --git a/arch/arm/boot/dts/k2l-evm.dts b/arch/arm/boot/dts/k2l-evm.dts
index 0086124..9c2b597 100644
--- a/arch/arm/boot/dts/k2l-evm.dts
+++ b/arch/arm/boot/dts/k2l-evm.dts
@@ -16,6 +16,26 @@
 	compatible = "ti,k2l-evm", "ti,k2l", "ti,keystone";
 	model = "Texas Instruments Keystone 2 Lamarr EVM";
 
+	reserved-memory {
+		#address-cells = <2>;
+		#size-cells = <2>;
+		ranges;
+
+		dsp_common_cma_pool: dsp_common_cma_pool {
+			compatible = "shared-dma-pool";
+			reg = <0x00000008 0x20000000 0x00000000 0x800000>;
+			reusable;
+			status = "okay";
+		};
+
+		dsp_reserved_code_area: dsp_reserved_code_area {
+			compatible = "shared-dma-pool";
+			reg = <0x00000008 0x20800000 0x00000000 0x1F7FFFFF>;
+			no-map;
+			status = "okay";
+		};
+	};
+
 	soc {
 		clocks {
 			refclksys: refclksys {
@@ -129,3 +149,29 @@
 		reg = <1>;
 	};
 };
+
+&dsp0 {
+	status = "okay";
+	memory-region = <&dsp_common_cma_pool>;
+};
+
+&dsp1 {
+	status = "okay";
+	memory-region = <&dsp_common_cma_pool>;
+};
+
+&dsp2 {
+	status = "okay";
+	memory-region = <&dsp_common_cma_pool>;
+};
+
+&dsp3 {
+	status = "okay";
+	memory-region = <&dsp_common_cma_pool>;
+};
+
+&uio_dspmem {
+	status = "okay";
+	mem  = <0x0c000000 0x000600000
+		0xa0000000 0x20000000>;
+};
diff --git a/arch/arm/boot/dts/k2l.dtsi b/arch/arm/boot/dts/k2l.dtsi
index 4446da7..1d7c30a 100644
--- a/arch/arm/boot/dts/k2l.dtsi
+++ b/arch/arm/boot/dts/k2l.dtsi
@@ -31,6 +31,13 @@
 		};
 	};
 
+	aliases {
+		rproc0 = &dsp0;
+		rproc1 = &dsp1;
+		rproc2 = &dsp2;
+		rproc3 = &dsp3;
+	};
+
 	soc {
 		/include/ "k2l-clocks.dtsi"
 
@@ -92,6 +99,83 @@
 			clock-names = "fck";
 			bus_freq	= <2500000>;
 		};
+
+		dsp0: dsp0 {
+			compatible = "ti,keystone-rproc";
+			reg = <0x02620844 4
+			       0x0235083c 4
+			       0x02350a3c 4
+			       0x02620240 4>;
+			reg-names = "boot-address", "psc-mdstat", "psc-mdctl",
+				"ipcgr";
+			mem = <0x10e00000 0x00008000
+			       0x10f00000 0x00008000
+			       0x10800000 0x00100000>;
+			interrupt-parent = <&kirq0>;
+			interrupts = <0 8>;
+			kick-gpio = <&dspgpio0 27 0>;
+			clocks = <&clkgem0>;
+			status = "disabled";
+		};
+
+		dsp1: dsp1 {
+			compatible = "ti,keystone-rproc";
+			reg = <0x02620848 4
+			       0x02350840 4
+			       0x02350a40 4
+			       0x02620244 4>;
+			reg-names = "boot-address", "psc-mdstat", "psc-mdctl",
+				"ipcgr";
+			mem = <0x11e00000 0x00008000
+			       0x11f00000 0x00008000
+			       0x11800000 0x00100000>;
+			interrupt-parent = <&kirq0>;
+			interrupts = <1 9>;
+			kick-gpio = <&dspgpio1 27 0>;
+			clocks = <&clkgem1>;
+			status = "disabled";
+		};
+
+		dsp2: dsp2 {
+			compatible = "ti,keystone-rproc";
+			reg = <0x0262084c 4
+			       0x02350844 4
+			       0x02350a44 4
+			       0x02620248 4>;
+			reg-names = "boot-address", "psc-mdstat", "psc-mdctl",
+				"ipcgr";
+			mem = <0x12e00000 0x00008000
+			       0x12f00000 0x00008000
+			       0x12800000 0x00100000>;
+			interrupt-parent = <&kirq0>;
+			interrupts = <2 10>;
+			kick-gpio = <&dspgpio2 27 0>;
+			clocks = <&clkgem2>;
+			status = "disabled";
+		};
+
+		dsp3: dsp3 {
+			compatible = "ti,keystone-rproc";
+			reg = <0x02620850 4
+			       0x02350848 4
+			       0x02350a48 4
+			       0x0262024c 4>;
+			reg-names = "boot-address", "psc-mdstat", "psc-mdctl",
+				"ipcgr";
+			mem = <0x13e00000 0x00008000
+			       0x13f00000 0x00008000
+			       0x13800000 0x00100000>;
+			interrupt-parent = <&kirq0>;
+			interrupts = <3 11>;
+			kick-gpio = <&dspgpio3 27 0>;
+			clocks = <&clkgem3>;
+			status = "disabled";
+		};
+
+		uio_dspmem: dspmem {
+			compatible = "ti,uio-ti-pdrv";
+			status = "disabled";
+		};
 		/include/ "k2l-netcp.dtsi"
 	};
 };
-- 
1.9.1

