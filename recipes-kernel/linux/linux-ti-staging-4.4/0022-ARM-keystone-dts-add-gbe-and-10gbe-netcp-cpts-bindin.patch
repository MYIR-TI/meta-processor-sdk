From d1baa358b72006633e31db0ab9a7fc3500110586 Mon Sep 17 00:00:00 2001
From: Murali Karicheri <m-karicheri2@ti.com>
Date: Tue, 3 May 2016 17:38:52 -0400
Subject: [PATCH 22/65] ARM: keystone: dts: add gbe and 10gbe netcp cpts
 bindings

This patch adds the netcp cpts DT bindings for the
gbe and 10gbe devices on the Keystone2 platforms.

Signed-off-by: WingMan Kwok <w-kwok2@ti.com>
Signed-off-by: Jacob Stiffler <j-stiffler@ti.com>
---
 arch/arm/boot/dts/keystone-k2e-netcp.dtsi  | 28 +++++++++++++++++++++++++---
 arch/arm/boot/dts/keystone-k2hk-netcp.dtsi | 30 ++++++++++++++++++++++++++----
 arch/arm/boot/dts/keystone-k2l-netcp.dtsi  | 13 ++++++++++++-
 3 files changed, 63 insertions(+), 8 deletions(-)

diff --git a/arch/arm/boot/dts/keystone-k2e-netcp.dtsi b/arch/arm/boot/dts/keystone-k2e-netcp.dtsi
index 9be1601..9f7da28 100644
--- a/arch/arm/boot/dts/keystone-k2e-netcp.dtsi
+++ b/arch/arm/boot/dts/keystone-k2e-netcp.dtsi
@@ -343,7 +343,7 @@ netcp: netcp@24000000 {
 	ranges = <0 0x24000000 0x1000000>;
 
 	clocks = <&clkpa>, <&clkcpgmac>, <&chipclk12>;
-	clock-names = "pa_clk", "ethss_clk", "cpts_rft_clk";
+	clock-names = "pa_clk", "ethss_clk", "cpts";
 	dma-coherent;
 
 	ti,navigator-dmas =	<&dma_gbe 0>,
@@ -400,6 +400,17 @@ netcp: netcp@24000000 {
 			tx-queue = <896>;
 			tx-channel = "nettx";
 
+			cpts {
+				status = "ok";
+				rftclk_sel = <0>;
+				/*rftclk_freq = <625000000>;*/
+				clock_mult = <4096>;
+				clock_shift = <9>;
+				clock_div = <5>;
+				ts_comp_length = <3>;
+				ts_comp_polarity = <1>; /* 1 - assert high */
+			};
+
 			interfaces {
 				gbe0: interface-0 {
 					phys		= <&serdes0_lane0>;
@@ -636,8 +647,8 @@ netcpx: netcp@2f00000 {
 	#size-cells	= <1>;
 	ranges;
 
-	clocks		= <&clkxge>;
-	clock-names	= "xge_clk";
+	clocks		= <&clkxge>, <&chipclk12>;
+	clock-names	= "xge_clk", "cpts";
 	dma-coherent;
 	/* big-endian; */
 
@@ -660,6 +671,17 @@ netcpx: netcp@2f00000 {
 			tx-queue = <692>;
 			tx-channel = "xnettx";
 
+			cpts {
+				status = "ok";
+				rftclk_sel = <0>;
+				/*rftclk_freq = <625000000>;*/
+				/*clock_mult = <2560>;*/
+				/*clock_shift = <10>;*/
+				/*clock_div = <1>;*/
+				ts_comp_length = <3>;
+				ts_comp_polarity = <1>; /* 1 - assert high */
+			};
+
 			interfaces {
 				xgbe0: interface-0 {
 					phys		= <&xserdes_lane0>;
diff --git a/arch/arm/boot/dts/keystone-k2hk-netcp.dtsi b/arch/arm/boot/dts/keystone-k2hk-netcp.dtsi
index 6a63a67..d356cd7 100644
--- a/arch/arm/boot/dts/keystone-k2hk-netcp.dtsi
+++ b/arch/arm/boot/dts/keystone-k2hk-netcp.dtsi
@@ -302,8 +302,8 @@ netcp: netcp@2000000 {
 	/* NetCP address range */
 	ranges  = <0 0x2000000 0x100000>;
 
-	clocks = <&clkpa>, <&clkcpgmac>, <&chipclk12>;
-	clock-names = "pa_clk", "ethss_clk", "cpts_rft_clk"	;
+	clocks = <&clkpa>, <&clkcpgmac>, <&chipclk13>;
+	clock-names = "pa_clk", "ethss_clk", "cpts";
 	dma-coherent;
 
 	ti,navigator-dmas =	<&dma_gbe 22>,	/* rx flow for CPSW port 0 */
@@ -344,6 +344,17 @@ netcp: netcp@2000000 {
 			tx-queue = <648>;
 			tx-channel = "nettx";
 
+			cpts {
+				status = "ok";
+				rftclk_sel = <1>;
+				/*rftclk_freq = <400000000>;*/
+				clock_mult = <2560>;
+				clock_shift = <10>;
+				clock_div = <1>;
+				ts_comp_length = <3>;
+				ts_comp_polarity = <1>; /* 1 - assert high */
+			};
+
 			interfaces {
 				gbe0: interface-0 {
 					phys = <&serdes_lane0>;
@@ -560,8 +571,8 @@ netcpx: netcp@2f00000 {
 	#size-cells	= <1>;
 	ranges;
 
-	clocks		= <&clkxge>;
-	clock-names	= "xge_clk";
+	clocks		= <&clkxge>, <&chipclk13>;
+	clock-names	= "xge_clk", "cpts";
 	dma-coherent;
 	/* big-endian; */
 
@@ -584,6 +595,17 @@ netcpx: netcp@2f00000 {
 			tx-queue = <8752>;
 			tx-channel = "xnettx";
 
+			cpts {
+				status = "ok";
+				rftclk_sel = <1>;
+				/*rftclk_freq = <400000000>;*/
+				/*clock_mult = <2560>;*/
+				/*clock_shift = <10>;*/
+				/*clock_div = <1>;*/
+				ts_comp_length = <3>;
+				ts_comp_polarity = <1>; /* 1 - assert high */
+			};
+
 			interfaces {
 				xgbe0: interface-0 {
 					phys = <&xserdes_lane0>;
diff --git a/arch/arm/boot/dts/keystone-k2l-netcp.dtsi b/arch/arm/boot/dts/keystone-k2l-netcp.dtsi
index 109c505..29660a7 100644
--- a/arch/arm/boot/dts/keystone-k2l-netcp.dtsi
+++ b/arch/arm/boot/dts/keystone-k2l-netcp.dtsi
@@ -288,7 +288,7 @@ netcp: netcp@26000000 {
 	ranges = <0 0x26000000 0x1000000>;
 
 	clocks = <&clkpa>, <&clkcpgmac>, <&chipclk12>, <&clkosr>;
-	clock-names = "pa_clk", "ethss_clk", "cpts_rft_clk", "osr_clk";
+	clock-names = "pa_clk", "ethss_clk", "cpts", "osr_clk";
 	dma-coherent;
 
 	ti,navigator-dmas =	<&dma_gbe 0>,
@@ -344,6 +344,17 @@ netcp: netcp@26000000 {
 			tx-queue = <896>;
 			tx-channel = "nettx";
 
+			cpts {
+				status = "ok";
+				rftclk_sel = <0>;
+				/*rftclk_freq = <399360000>;*/
+				/*clock_mult = <5000>;*/
+				/*clock_shift = <10>;*/
+				/*clock_div = <3>; */
+				ts_comp_length = <3>;
+				ts_comp_polarity = <1>; /* 1 - assert high */
+			};
+
 			interfaces {
 				gbe0: interface-0 {
 					phys		= <&serdes0_lane0>;
-- 
1.9.1

