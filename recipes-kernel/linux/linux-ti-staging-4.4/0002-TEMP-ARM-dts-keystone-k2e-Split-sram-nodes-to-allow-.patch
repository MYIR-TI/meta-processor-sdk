From a95a6b46cad5bbce7d5e39a371a76ab5dc52bb54 Mon Sep 17 00:00:00 2001
From: Sam Nelson <sam.nelson@ti.com>
Date: Tue, 29 Nov 2016 14:44:05 -0500
Subject: [PATCH 2/4] TEMP: ARM: dts: keystone-k2e: Split sram nodes to allow
 section for CMEM use

Currently the reg entry in kernel dtb reserves the whole MSMC ram range
to be used only through the mmio-sram driver.

Given that other modules (like CMEM) also currently reserve memory from
MSMC, the reg entry which takes over the whole memory breaks those
functionality.
This patch will allow module like CMEM to reserve and use a non-
overlapping section of memory not marked reserved by the sub nodes here.
And is a workaround to unblock functionality.
Final solution is to implement functionality in CMEM driver to use sram
sub nodes directly.

Resolves current issue with CMEM module reporting error allocating MSMC
memory.

Signed-off-by: Sam Nelson <sam.nelson@ti.com>
---
 arch/arm/boot/dts/keystone-k2e.dtsi | 16 ++++++++++++----
 1 file changed, 12 insertions(+), 4 deletions(-)

diff --git a/arch/arm/boot/dts/keystone-k2e.dtsi b/arch/arm/boot/dts/keystone-k2e.dtsi
index 553c423..4c3ec7f 100644
--- a/arch/arm/boot/dts/keystone-k2e.dtsi
+++ b/arch/arm/boot/dts/keystone-k2e.dtsi
@@ -98,8 +98,8 @@
 
 		msm_ram: msmram@0c000000 {
 			compatible = "mmio-sram";
-			reg = <0x0c000000 0x200000>;
-			ranges = <0x0 0x0c000000 0x200000>;
+			reg = <0x0c000000 0x80000>;
+			ranges = <0x0 0x0c000000 0x80000>;
 			#address-cells = <1>;
 			#size-cells = <1>;
 
@@ -107,9 +107,17 @@
 				compatible = "ti,keystone-dsp-msm-ram";
 				reg = <0x0 0x80000>;
 			};
+		};
+
+		msm_ram1: msmram1@0c1f0000 {
+			compatible = "mmio-sram";
+			reg = <0x0c1f0000 0x10000>;
+			ranges = <0x0 0x0c1f0000 0x10000>;
+			#address-cells = <1>;
+			#size-cells = <1>;
 
-			sram-bm@1f0000 {
-				reg = <0x001f0000 0x8000>;
+			sram-bm@0 {
+				reg = <0x0 0x8000>;
 			};
 		};
 
-- 
1.9.1

